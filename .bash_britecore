#BDE setups
export REPO_DIR=~/bx
export BRITE_DEV=$REPO_DIR/britedevenv
export PATH=$PATH:$BRITE_DEV
export COMPOSE_HTTP_TIMEOUT=300
export DEPLOYMENT_PATH=/srv/www

#shorthand tools for BDE
alias regen_env="python $BRITE_DEV/tools/cfg_to_env.py $REPO_DIR/britecore/britecore.cfg"

build_env() {
    docker-compose -f "$BRITE_DEV/clients-$1.yml" -p $1 build
}

start_env() {
	docker-compose -f "$BRITE_DEV/clients-$1.yml" -p $1 up -d
}

stop_env() {
	docker-compose -f "$BRITE_DEV/clients-$1.yml" -p $1 stop
}

down_env() {
	docker-compose -f "$BRITE_DEV/clients-$1.yml" -p $1 down
}

enter_web() {
	docker exec -it "$1_web_1" bash
}

alias destroy_dangling="./tools/destroy_all.sh"

existing_ymls() {
	echo ""
	for yml in $BRITE_DEV/clients-*; do
	    echo -n "$yml - [Last Modified] "; stat -f "%Sm" -t "%Y-%m-%d %H:%M" "$yml"
	done;
	echo ""
}

cleanup_containers() {
	docker rm "$1_web_1"
	docker rm "$1_db-setup_1"
	docker rm "$1_task-queue_1"
	docker rm "$1_britecore_1"
	docker rm "$1_db_1"
	docker rm "$1_base_1"
	docker rm "$1_rabbitmq_1"
	docker rm "$1_redis_1"
	docker rm "$1_elasticsearch_1"
}

cleanup_images() {
	docker image rm "$1_db-setup"
	docker image rm "$1_task-queue"
	docker image rm "$1_web"
}

delete_env() {
	down_env $1
	cleanup_containers $1
	cleanup_images $1
	docker system df
}

help_env() {
	echo ""
	echo "build_env <client-name>"
	echo "start_env <client-name>"
	echo "stop_env  <client-name>"
	echo "down_env  <client-name>"
	echo "enter_web <client-name>"
	echo "existing_ymls"
	echo "regen_env"
	echo ""
	echo "delete_env <client-name>"
}